services:
  # ─────────────────────────────────────────────
  # PicoClaw Agent (one-shot query)
  #   docker compose -f docker/docker-compose.yml run --rm picoclaw-agent -m "Hello"
  # ─────────────────────────────────────────────
  picoclaw-agent:
    image: docker.io/sipeed/picoclaw:latest
    container_name: picoclaw-agent
    profiles:
      - agent
    # Uncomment to access host network; leave commented unless needed.
    #extra_hosts:
    #  - "host.docker.internal:host-gateway"
    volumes:
      - ./data:/root/.picoclaw
    entrypoint: ["picoclaw", "agent"]
    stdin_open: true
    tty: true

  # ─────────────────────────────────────────────
  # PicoClaw Gateway (Long-running Bot)
  #   docker compose -f docker/docker-compose.yml up picoclaw-gateway
  # ─────────────────────────────────────────────
  picoclaw-gateway:
    image: docker.io/sipeed/picoclaw:latest
    container_name: picoclaw-gateway
    restart: on-failure
    profiles:
      - gateway
    # Uncomment to access host network; leave commented unless needed.
    #extra_hosts:
    #  - "host.docker.internal:host-gateway"
    volumes:
      - ./data:/root/.picoclaw
    ports:
      - "8000:8000"   # AITuber WebSocket server

  # ─────────────────────────────────────────────
  # AITuber Kit (Next.js - external linkage mode)
  #   docker compose --profile aituber up
  # ─────────────────────────────────────────────
  aituber-kit:
    build:
      context: ./aituber-kit
      dockerfile: Dockerfile
    container_name: aituber-kit
    restart: unless-stopped
    profiles:
      - aituber
    ports:
      - "3000:3000"
    environment:
      - NEXT_PUBLIC_EXTERNAL_LINKAGE_MODE=true
      - NEXT_PUBLIC_WS_URL=ws://picoclaw-gateway:8000/ws
      - PORT=3000
      - HOSTNAME=0.0.0.0
    depends_on:
      - picoclaw-gateway
